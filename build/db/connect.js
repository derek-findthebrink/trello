// Generated by CoffeeScript 1.9.3
(function() {
  var aRequest, applicationName, download, exports, fs, fsReadOpts, getToken, readKey, request;

  console.log('trello file init');

  request = require("request");

  fs = require("fs");

  fsReadOpts = {
    encoding: "utf8"
  };

  applicationName = "brink-trello";

  readKey = function(cb) {
    return fs.readFile("./.cred", fsReadOpts, function(err, data) {
      var json, key;
      if (err) {
        throw err;
      }
      json = JSON.parse(data);
      key = json.key;
      return cb(key);
    });
  };

  aRequest = function(key) {
    var url, urlWKey;
    url = "https://api.trello.com/1/board/4d5ea62fd76aa1136000000c";
    urlWKey = url + "?key=" + key;
    return request(urlWKey, function(err, response, body) {
      if (err) {
        throw err;
      }
      return console.log(body);
    });
  };

  getToken = function(key) {
    var opts, url;
    url = "https://trello.com/1/authorize";
    opts = {
      qs: {
        callback_method: "postMessage",
        scope: "read",
        expiration: "1hour",
        name: "brink-trello",
        key: key
      }
    };
    return request.get(url, opts, function(err, response, body) {
      if (err) {
        throw err;
      }
      return console.log(body);
    });
  };

  download = function() {
    return readKey(getToken);
  };

  module.exports = exports = {
    download: download
  };

}).call(this);
